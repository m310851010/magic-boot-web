<nzx-page>
  <nzx-header>
    <form nz-form [formGroup]="searchForm">
      <ma-form-search [table]="table" [form]="searchForm" [buttonAlignRight]="false">
        <formly-form [form]="searchForm" [fields]="searchFields" [model]="searchModel"></formly-form>
      </ma-form-search>
    </form>
  </nzx-header>

  <nzx-content>
    <nzx-table #table [api]="menus$" [nzxColumns]="columns" [nzShowPagination]="false" [nzxFit]="true">
      <div title>
        <nz-space>
          <ng-container *auth="'menu:save'">
            <button *nzSpaceItem nz-button nzType="primary" (click)="onNewOpenModal({}, modalTemplate, table)">
              <span nz-icon nzType="plus"></span>
              新增
            </button>
          </ng-container>

          <ng-container *auth="'menu:delete'">
            <button *nzSpaceItem nz-button nzDanger (click)="onBatchDelete(table)">
              <span nz-icon nzType="delete"></span>
              批量删除
            </button>
          </ng-container>
        </nz-space>
      </div>
      <ng-template named="buttons" let-row>
        <a *auth="'user:save'" (click)="onUpdateOpenModal(row, modalTemplate, table)" class="mr-xs">修改</a>
        <a *auth="'user:save'" (click)="onNewOpenModal(row, modalTemplate, table)" class="mr-xs">新增</a>
        <a *auth="'user:delete'" (click)="onDeleteClick(row, table)">删除</a>
      </ng-template>
    </nzx-table>
  </nzx-content>
</nzx-page>

<ng-template #modalTemplate>
  <form nz-form [formGroup]="modalForm">
    <formly-form
      [formly-box]="[]"
      [form]="modalForm"
      [fields]="modalFields"
      [model]="modalModel"
      [options]="{ formState: { nzGutter: 10, colNzSpan: 12, labelNzFlex: '80px' } }"
    >
      <ng-template named="pwd">
        <ma-input-password formControlName="password" placeholder="请输入密码"></ma-input-password>
      </ng-template>
    </formly-form>
  </form>
</ng-template>
